name: Start GotoHTTP on Windows

on:
  workflow_dispatch:

jobs:
  run-gotohttp:
    runs-on: windows-latest

    steps:
    - name: ä¸‹è½½ GotoHTTP zip åŒ…
      run: |
        Invoke-WebRequest -Uri "https://www.gotohttp.com/gotohttp_x64.zip" -OutFile "gotohttp_x64.zip"

    - name: è§£å‹ GotoHTTP
      run: |
        Expand-Archive -Path "gotohttp_x64.zip" -DestinationPath "gotohttp"

    - name: å¯åŠ¨ GotoHTTP å¹¶æå–è®¾å¤‡ç 
      run: |
        $exePath = Resolve-Path ".\gotohttp\GotoHTTP_x64.exe"
        $outputFile = "$env:TEMP\gotohttp_output.txt"

        # å¯åŠ¨ GotoHTTP å¹¶å†™å…¥æ ‡å‡†è¾“å‡ºæ–‡ä»¶
        Start-Process -FilePath $exePath `
                      -ArgumentList "-quiet -password 123456" `
                      -RedirectStandardOutput $outputFile `
                      -WindowStyle Hidden

        Start-Sleep -Seconds 5  # ç­‰å¾…è¾“å‡ºå®Œæˆ

        # è¯»å–è¾“å‡º
        if (Test-Path $outputFile) {
          $content = Get-Content $outputFile -Raw
          Write-Output "âœ… GotoHTTP å¯åŠ¨è¾“å‡ºå¦‚ä¸‹ï¼š"
          Write-Output $content

          if ($content -match "This device ID:\s*(\w+)") {
              $deviceId = $matches[1]
              Write-Output "-----------------------------"
              Write-Output "ğŸ¯ è¿œç¨‹åœ°å€ï¼šhttps://www.gotohttp.com/"
              Write-Output "ğŸ”‘ è®¾å¤‡ç ï¼š$deviceId"
              Write-Output "ğŸ” å¯†ç ï¼š123456"
              Write-Output "-----------------------------"
          } else {
              Write-Output "âŒ æœªèƒ½æå–è®¾å¤‡ç ï¼Œè¾“å‡ºä¸­æœªå‘ç°åŒ¹é…è¡Œã€‚"
          }
        } else {
          Write-Output "âŒ è¾“å‡ºæ–‡ä»¶ä¸å­˜åœ¨ï¼ŒGotoHTTP æœªè¾“å‡ºä»»ä½•å†…å®¹ã€‚"
        }
