name: Start GotoHTTP on Windows

on:
  workflow_dispatch:

jobs:
  run-gotohttp:
    runs-on: windows-latest

    steps:
    - name: ä¸‹è½½ GotoHTTP zip åŒ…
      run: |
        Invoke-WebRequest -Uri "https://www.gotohttp.com/gotohttp_x64.zip" -OutFile "gotohttp_x64.zip"

    - name: è§£å‹ GotoHTTP
      run: |
        Expand-Archive -Path "gotohttp_x64.zip" -DestinationPath "gotohttp"

    - name: å¯åŠ¨ GotoHTTP å¹¶æå–è®¾å¤‡ç 
      run: |
        $exePath = Resolve-Path ".\gotohttp\GotoHTTP_x64.exe"
        $output = & $exePath -quiet -password 123456
        Write-Output "âœ… GotoHTTP å¯åŠ¨è¾“å‡ºï¼š"
        Write-Output $output

        # æå–è®¾å¤‡ç 
        $deviceIdLine = $output | Select-String "This device ID:"
        if ($deviceIdLine -match "This device ID:\s*(\w+)")
        {
            $deviceId = $matches[1]
            Write-Output "-----------------------------"
            Write-Output "ğŸ¯ è¿œç¨‹åœ°å€ï¼šhttps://www.gotohttp.com/"
            Write-Output "ğŸ”‘ è®¾å¤‡ç ï¼š$deviceId"
            Write-Output "ğŸ” å¯†ç ï¼š123456"
            Write-Output "-----------------------------"
        }
        else
        {
            Write-Output "âŒ æœªèƒ½æå–è®¾å¤‡ç ï¼Œå¯èƒ½ GotoHTTP æœªæ­£ç¡®å¯åŠ¨æˆ–è¾“å‡ºæ ¼å¼å˜åŒ–ã€‚"
        }
